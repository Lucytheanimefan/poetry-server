import requests
from bs4 import BeautifulSoup
import sklearn
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.feature_extraction.text import TfidfVectorizer


class PoetrySources:
    OK_NUMBERS = ["89000","43000"]

    def __init__(self):
        self.source = "https://www.poetryfoundation.org/poems"
        self.urls = []
        self.poems = []
        self.vectorizer = CountVectorizer()
        self.tfid_vectorizer = TfidfVectorizer()


    def find_urls(self, limit = 100):
        headers = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36"}
        for i in range(limit):
            url = "%s/%i" % (self.source, 43000+i)
            print(url)
            # Make the request
            r = requests.get(url, headers=headers)
            soup = BeautifulSoup(r.text, "html.parser")
            #print(soup.prettify())
            poem = soup.find("div", {"class":"o-poem"})
            if poem is not None:
                poem_text = poem.find_all("div")
                if poem_text is not None and len(poem_text)>0:
                    print("Not none!")
                    self.urls.append(url)
                    self.poems.append([poem.text for poem in poem_text])

        print(self.urls)
        print(self.poems)

    def tokenize_poems(self):
        for poem in self.poems:
            self.vectorizer.fit(poem)
            self.tfid_vectorizer.fit(poem)
            print(self.tfid_vectorizer.vocabulary_)
            print(self.tfid_vectorizer.idf_)
            print("")
            #print(self.vectorizer.vocabulary_)


class PoetryParser:

    def __init__(self, url):
        r = requests.get(url)
        # print(r.text)
        self.soup = BeautifulSoup(r.text, "html.parser")
        self.url = url

    def parse(self):
        return self.soup.find_all("pre")[0]

    def parse_found(self):
        return self.soup.find_all("div", {"class": "o-poem"})


if __name__=="__main__":
    #p = PoetryParser("https://www.poets.org/poetsorg/poem/fly-0");
    # p1 = PoetryParser("https://www.poetryfoundation.org/poems/46304/retrospect-56d226248e844");
    #print(p.parse())
    sources = PoetrySources()
    sources.poems = [['These alternate nights and days, these seasons', '\r Somehow fail to convince me. It seems', '\r I have the sense of infinity!', '', '\r (In your dreams, O crew of Columbus,', '\r O listeners over the sea', '\r For the surf that breaks upon Nothing—)', '', '\r Once I was waked by the nightingales in the garden.', '\r I thought, What time is it? I thought,', '\r Time—Is it Time still?—Now is it Time?', '', '\r (Tell me your dreams, O sailors:', '\r Tell me, in sleep did you climb', '\r The tall masts, and before you—)', '', '\r At night the stillness of old trees', '\r Is a leaning over and the inertness', '\r Of hills is a kind of waiting.', '', '\r (In sleep, in a dream, did you see', '\r The world’s end? Did the water', '\r Break—and no shore—Did you see?)', '', '\r Strange faces come through the streets to me', '\r Like messengers: and I have been warned', '\r By the moving slowly of hands at a window.', '', '\r Oh, I have the sense of infinity—', '\r But the world, sailors, is round.', '\r They say there is no end to it.', ''], ['The incoherent rushing of the train', '\r Dulls like a drugged pain', '', '\r Numbs', '\r To an ether throbbing of inaudible drums', '', '\r Unfolds', '\r Hush within hush until the night withholds', '', '\r Only its darkness.', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 From the deep', '\r Dark a voice calls like a voice in sleep', '', '\r Slowly a strange name in a strange tongue.', '', '\r Among', '', '\r The sleeping listeners a sound', '\r As leaves stir faintly on the ground', '', '\r When snow falls from a windless sky—', '\r A stir\xa0\xa0\xa0 A sigh', ''], ['The star dissolved in evening—the one star', '\r The silently', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 and night O soon now, soon', '\r And still the light now', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0and still now the large', '\r Relinquishing', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0and through the pools of blue', '\r Still, still the swallows', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0and a wind now', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0and the tree', '\r Gathering darkness:', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0I was small. I lay', '\r Beside my mother on the grass, and sleep', '\r Came—', '', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 slow hooves and dripping with the dark', '\r The velvet muzzles, the white feet that move', '\r In a dream water', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0and O soon now soon', '\r Sleep and the night.', '', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0And I was not afraid.', '\r Her hand lay over mine. Her fingers knew', '\r Darkness,—and sleep—the silent lands, the far', '\r Far off of morning where I should awake.', ''], ['And here face down beneath the sun', '\r And here upon earth’s noonward height', '\r To feel the always coming on', '\r The always rising of the night:', '', '\r To feel creep up the curving east', '\r The earthy chill of dusk and slow', '\r Upon those under lands the vast', '\r And ever climbing shadow grow', '', '\r And strange at Ecbatan the trees', '\r Take leaf by leaf the evening strange', '\r The flooding dark about their knees', '\r The mountains over Persia change', '', '\r And now at Kermanshah the gate', '\r Dark empty and the withered grass', '\r And through the twilight now the late', '\r Few travelers in the westward pass', '', '\r And Baghdad darken and the bridge', '\r Across the silent river gone', '\r And through Arabia the edge', '\r Of evening widen and steal on', '', '\r And deepen on Palmyra’s street', '\r The wheel rut in the ruined stone', '\r And Lebanon fade out and Crete', '\r High through the clouds and overblown', '', '\r And over Sicily the air', '\r Still flashing with the landward gulls', '\r And loom and slowly disappear', '\r The sails above the shadowy hulls', '', '\r And Spain go under and the shore', '\r Of Africa the gilded sand', '\r And evening vanish and no more', '\r The low pale light across that land', '', '\r Nor now the long light on the sea:', '', '\r And here face downward in the sun', '\r To feel how swift how secretly', '\r The shadow of the night comes on ...', '', '\r \xa0', ''], ['I speak this poem now with grave and level voice\xa0\xa0\xa0', '\r In praise of autumn, of the far-horn-winding fall.', '', '\r I praise the flower-barren fields, the clouds, the tall\xa0\xa0\xa0', '\r Unanswering branches where the wind makes sullen noise.', '', '\r I praise the fall: it is the human season.', '\r \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Now', '\r No more the foreign sun does meddle at our earth,\xa0\xa0\xa0', '\r Enforce the green and bring the fallow land to birth,\xa0\xa0\xa0', '\r Nor winter yet weigh all with silence the pine bough,', '', '\r But now in autumn with the black and outcast crows\xa0\xa0\xa0', '\r Share we the spacious world: the whispering year is gone:\xa0\xa0\xa0', '\r There is more room to live now: the once secret dawn\xa0\xa0\xa0', '\r Comes late by daylight and the dark unguarded goes.', '', '\r Between the mutinous brave burning of the leaves\xa0\xa0\xa0', '\r And winter’s covering of our hearts with his deep snow\xa0\xa0\xa0', '\r We are alone: there are no evening birds: we know\xa0\xa0\xa0', '\r The naked moon: the tame stars circle at our eaves.', '', '\r It is the human season. On this sterile air', '\r Do words outcarry breath: the sound goes on and on.\xa0\xa0\xa0', '\r I hear a dead man’s cry from autumn long since gone.', '', '\r I cry to you beyond upon this bitter air.', ''], ['Señora, it is true the Greeks are dead.', '', '\r It is true also that we here are Americans:', '\r That we use the machines: that a sight of the god is unusual:', '\r That more people have more thoughts: that there are', '', '\r Progress and science and tractors and revolutions and', '\r Marx and the wars more antiseptic and murderous', '\r And music in every home: there is also Hoover.', '', '\r Does the lady suggest we should write it out in The Word?', '\r Does Madame recall our responsibilities? We are', '\r Whores, Fräulein: poets, Fräulein, are persons of', '', '\r Known vocation following troops: they must sleep with', '\r Stragglers from either prince and of both views.', '\r The rules permit them to further the business of neither.', '', '\r It is also strictly forbidden to mix in maneuvers.', '\r Those that infringe are inflated with praise on the plazas—', '\r Their bones are resultantly afterwards found under newspapers.', '', '\r Preferring life with the sons to death with the fathers,', '\r We also doubt on the record whether the sons', '\r Will still be shouting around with the same huzzas—', '', '\r For we hope Lady to live to lie with the youngest.', '\r There are only a handful of things a man likes,', '\r Generation to generation, hungry or', '', '\r Well fed: the earth’s one: life’s', '\r One: Mister Morgan is not one.', '', '\r There is nothing worse for our trade than to be in style.', '', '\r He that goes naked goes further at last than another.', '\r Wrap the bard in a flag or a school and they’ll jimmy his', '\r Door down and be thick in his bed—for a month:', '', '\r (Who recalls the address now of the Imagists?)', '\r But the naked man has always his own nakedness.', '\r People remember forever his live limbs.', '', '\r They may drive him out of the camps but one will take him.', '\r They may stop his tongue on his teeth with a rope’s argument—', '\r He will lie in a house and be warm when they are shaking.', '', '\r Besides, Tovarishch, how to embrace an army?', '\r How to take to one’s chamber a million souls?', '\r How to conceive in the name of a column of marchers?', '', '\r The things of the poet are done to a man alone', '\r As the things of love are done—or of death when he hears the', '\r Step withdraw on the stair and the clock tick only.', '', '\r Neither his class nor his kind nor his trade may come near him', '\r There where he lies on his left arm and will die,', '\r Nor his class nor his kind nor his trade when the blood is jeering', '', '\r And his knee’s in the soft of the bed where his love lies.', '', '\r I remind you, Barinya, the life of the poet is hard—', '\r A hardy life with a boot as quick as a fiver:', '', '\r Is it just to demand of us also to bear arms?', '\r \xa0', ''], ['Think of our blindness where the water burned!', '\r Are we so certain that those wings, returned', '\r And turning, we had half discerned', '\r Before our dazzled eyes had surely seen', '\r The bird aloft there, did not mean?—', '\r Our hearts so seized upon the sign!', '', '\r Think how we sailed up-wind, the brine', '\r Tasting of daphne, the enormous wave', '\r Thundering in the water cave—', '\r Thunder in stone. And how we beached the skiff', '\r And climbed the coral of that iron cliff', '\r And found what only in our hearts we’d heard—', '\r The silver screaming of that one, white bird:', '\r The fabulous wings, the crimson beak', '\r That opened, red as blood, to shriek', '\r And clamor in that world of stone,', '\r No voice to answer but its own.', '', '\r What certainty, hidden in our hearts before,', '\r Found in the bird its metaphor?', ''], ['When liberty is headlong girl', '\r And runs her roads and wends her ways', '\r Liberty will shriek and whirl', '\r Her showery torch to see it blaze.', '', '\r When liberty is wedded wife', '\r And keeps the barn and counts the byre', '\r Liberty amends her life.', '\r She drowns her torch for fear of fire.', ''], ['You, my friends, and you strangers, all of you,', '\r Stand with me a little by the walls', '\r Or where the walls once were.', '\r The bridge was here, the city further:', '\r Now there is neither bridge nor town—', '\r A doorway where the roof is down', '\r Opens on a foot-worn stair', '\r That climbs by three steps into empty air.', '\r (What foot went there?)', '\r Nothing in this town that had a thousand steeples', '\r Lives now but these flocks of sheep', '\r Grazing the yellow grasses where the bricks lie dead beneath:', '\r Dogs drive them with their brutal teeth.', '', '\r Can none but sheep live where the walls go under?', '\r Is man’s day over and the sheep’s begun?', '\r And shall we sit here like the mourners on a dunghill', '\r Shrilling with melodious tongue—', '\r Disfiguring our faces with the nails of our despair?', '\r (What dust is this we sift upon our hair?)', '\r Because a world is taken from us as the camels from the man of Uz', '\r Shall we sit weeping for the world that was', '\r And curse God and so perish?', '\r Shall monuments be grass and sheep inherit them?', '\r Shall dogs rule in the rubble of the arches?', '', '\r Consider, Oh consider what we are!', '\r Consider what it is to be a man—', '\r He who makes his journey by the glimmer of a candle;', '\r Who discovers in his mouth, between his teeth, a word;', '\r Whose heart can bear the silence of the stars— that burden;', '\r Who comes upon his meaning in the blindness of a stone—', '\r A girl’s shoulder, perfectly harmonious!', '', '\r Even the talk of it would take us days together.', '\r Marvels men have made, Oh marvels!—and our breath', '\r Brief as it is: our death waiting—', '\r Marvels upon marvels! Works of state—', '\r The imagination of the shape of order!', '\r Works of beauty—the cedar door', '\r Perfectly fitted to the sill of basalt!', '\r Works of grace—', '\r The ceremony at the entering of houses,', '\r At the entering of lives: the bride among the torches in the shrill carouse!', '', '\r Works of soul—', '\r Pilgrimages through the desert to the sacred boulder:', '\r Through the mid night to the stroke of one!', '\r Works of grace! Works of wonder!', '\r All this have we done and more—', '\r And seen—what have we not seen?—', '', '\r A man beneath the sunlight in his meaning:', '\r A man, one man, a man alone.', '', '\r In the sinks of the earth that wanderer has gone down.', '\r The shadow of his mind is on the mountains.', '\r The word he has said is kept in the place beyond', '\r As the seed is kept and the earth ponders it.', '\r Stones—even the stones remember him:', '\r Even the leaves—his image is in them.', '\r And now because the city is a ruin in the waste of air', '\r We sit here and despair!', '\r Because the sheep graze in the dying grove', '\r Our day is over!', '\r We must end', '\r Because the talk around the table in the dusk has ended,', '\r Because the fingers of the goddesses are found', '\r Like marble pebbles in the gravelly ground', '\r And nothing answers but the jackal in the desert,—', '\r Because the cloud proposes, the wind says!', '', '\r Because the sheep are pastured where the staring statues lie', '\r We sit upon the sand in silence', '\r Watching the sun go and the shadows change!', '', '\r Listen, my friends, and you, all of you, strangers,', '\r Listen, the work of man, the work of splendor', '\r Never has been ended or will end.', '\r Even where the sheep defile the ruined stair', '\r And dogs are masters—even there', '\r One man’s finger in the dust shall trace the circle.', '', '\r Even among the ruins shall begin the work,', '\r Large in the level morning of the light', '\r And beautiful with cisterns where the water whitens,', '\r Rippling upon the lip of stone, and spills', '\r By cedar sluices into pools, and the young builders', '\r String their plumb lines, and the well-laid course', '\r Blanches its mortar in the sun, and all the morning', '\r Smells of wood-smoke, rope-tar, horse-sweat, pitch-pine,', '\r Men and the trampled mint leaves in the ditch.', '', '\r One man in the sun alone', '\r Walks between the silence and the stone:', '\r The city rises from his flesh, his bone.', '\r \xa0', '']]
    sources.tokenize_poems()
    #sources.find_urls(10)

